FROM golang:1.7.5

ENV GOSU_VERSION 1.10
RUN apt-update || echo "1"
RUN set -x \
	#  go get -v github.com/wadey/gocovmerge && \
	#  go get github.com/onsi/ginkgo/ginkgo && \
	#  go get github.com/onsi/gomega && \
	#  go get github.com/nats-io/nats && \
	#  go get github.com/derekparker/delve/cmd/dlv && \
  apt-get install -y --no-install-recommends ca-certificates wget rsync && \
  rm -rf /var/lib/apt/lists/* && \
  dpkgArch="$(dpkg --print-architecture | awk -F- '{ print $NF }')" && \
  wget -O /usr/local/bin/gosu "https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch" && \
  wget -O /usr/local/bin/gosu.asc "https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc" && \
  export GNUPGHOME="$(mktemp -d)" && \
  gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 && \
  gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu && \
  rm -r "$GNUPGHOME" /usr/local/bin/gosu.asc && \
  chmod +x /usr/local/bin/gosu && \
  gosu nobody true && \
  apt-get purge -y --auto-remove ca-certificates wget

# Controller install steps
COPY entrypoint.builder.debian.sh /entrypoint.sh

ENTRYPOINT [ "/entrypoint.sh" ]
CMD [ "/bin/bash" ]
